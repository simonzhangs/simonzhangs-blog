---
title: JavaScript的字符编码
date: 2022-05-07 15:10:17
permalink: /pages/b7d614/
categories:
  - 技术
  - 涨知识
tags:
  - 
---
## 字符集

各个国家文字、字母、标点符号等等的集合，成为字符集。

ASCII字符集：计算机最初流行在欧美国家，针对他们的字符集合，主要是拉丁字母和阿拉伯数字。一共规定了128个字符以及对应的二进制转换关系，128个字符包括了可现实的26个大小写字母、10个数字、标点符号以及特殊的控制符。这128个字符用一个字节（8bit）来表示绰绰有余，一个字节可以表示256个字符，所以ASCII编码当前只利用了字节的7为，最高位统一置0。

![ASCII字符集](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/03207f3ba927412e8fe7bf85f61e741e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)

Unicode字符集：ASCII字符集具有很大的局限性，只能诸多表示127个字符，而没有考虑汉字、阿拉伯语等文字字符。Unicode是全世界所有字符的一个集合。每个字符对应一个数字，每个数字对应一个字符，而这个数字也称之为码点，根据码点就可以从字符集中索引到对应的字符。

## 字符编码

先来说一下什么是字符编码呢？我们计算机传输和存储的数据都是二进制的，对于字符也是如此。把一个数值与字符集中的字符进行唯一匹配，对应的规则就称为字符编码。上面提到的字符集，会有一套与二进制数值对应的规则，即为对应的ASCII编码、Unicode编码等等。

Unicode编码方式的优点是它涵盖了所有的字符集合，缺点是因为涵盖了所有的字符集合，所有它相比于ASCII编码占用的字节多。比如说ASCII编码中一个字符只占1字节，而同样的字符在Unicode编码中至少占据3个字节，而我们并不会用的Unicode中所有的字符，常用的字符都分布在一个平面上，直接使用Unicode来表示字符就太浪费存储空间和传输流量了。

于是便出现了UTF-8、16、32等编码方式（Unicode Transformation Format），用来平衡Unicode所有平面字符的存储空间、兼容和解码问题。我们常见的UTF-8就是一种字符编码方式，它是针对Unicode的可变长度字符编码，也是一种前缀码。它可以用来表示Unicode标准中的任何字符，且其编码中的第一个字节仍然兼容ASCII字符集。

:::tip
Unicode只规定了每个字符的码点，到底用什么样的字节序列表示这个码点，就涉及到了编码方法。对Unicode编码的方法有UTF--8、UTF-16和UTF-32。
:::

### UTF-32编码

这是最直观的编码方法，每个码点都使用4个字节来表示，字节内容与码点一一对应，这就是UTF-32。

比如说：码点0就用四个字节的0表示，码点597D就在前面加两个字节的0。

```
U+0000 = 0x0000 0000

U+597D = 0x0000 597D
```

特点：
- 查找效率高，时间复杂度o(1);
- 浪费空间，比相同的ACII编码文件大四倍；
- HTML5标准明文规定，网页不得编码成UTF-32。


### UTF-8 编码

UTF-8编码方式可以节省空间，它是变长的编码方法，字符长度从1一个字节到4个字节不等。越是常用的字符，字节越短，最前面的128个字符，只使用1个字节表示，与ASCII码完全相同。

UTF-8编码方式：
- 对于单字节字符，字节第一位置零，后7位使用该字符Unicode码点。即该字符编码同ASCII码一致
- 对于n（n > 1）个字节字符，最高位字节，前n位置1，第n + 1位置0，剩余低字节均以10开头，有效的二进制位（下图中的x占用位）则表示该字符的Unicode码点。

| Unicode码点范围（十六进制）| UTF-8编码方式（二进制）| 字节数 |
| :---: | :---: | :---: |
| U+0000 U+007F(0~127)|0xxx xxxx |单字节|
| U+0080  U+07FF(128~2047) | 110x xxxx 10xx xxxx |双字节
| U+0800 U+FFFF(2048~65535)|1110 xxxx 10xx xxxx 10xx xxxx | 三字节
| U+10000 U+10FFFF(65536~2097151)| 1111 0xxx 10xx xxxx 10xx xxxx 10xx xxxx | 四字节

### UTF-16编码

UTF-16编码介于UTF-32与UTF-8之间，同时结合了定长和变长两种编码方法的特点。

它的编码规则：基本平面的字符占用2个字节，辅助平面的字符占用4个字节。即UTF-16的编码长度要么是2个字节（U+0000到U+FFFF），要么是4个字节（U+010000到U+10FFFF）






## JavaScript编码

### JS采用哪一种编码

JavaScript语言采用Unicode字符集，但是只支持一种编码方法。这种编码不是UTF-16、8、32，用的是UCS-2！

因此有两个团队都想来搞统一字符集，一个是Unicode，另外一个就是UCS-2字符集；当他们发现彼此之后，决定合并成一套字符集，就是Unicode。但是呢，UCS的开发速度快于Unicode，开发了第一套编码方法UCS-2，使用2个字节表示已经有的码点字符。

而Unicode的编码方式之一UTF-16编码晚于UCS-2编码方法，即UTF-16宣布是UCS-2的超集；即UTF-16取代了UCS-2，也可以说UCS-2被整合进了UTF-16。

### 为什么JS选择已经淘汰的UCS-2编码方式

为什么JavaScript不选用更高级的UTF-16呢？因为JavaScript语言出现的以后，根本没有UTF-16编码，JS语言发明者只用了10天设计了JavaScript语言，随后出现了解释引擎。

### JS字符函数的局限

因为JS采用Unicode字符集，但是只支持16位的UTF-16编码，不支持32位。

由于JavaScript只能处理UCS-2编码，造成所有字符在这门语言中都是2个字节，如果是4个字节的字符，会被当作2个双字节的字符穿里。JavaScript的字符函数都受到了这一点的影响，无法返回正确结果。


