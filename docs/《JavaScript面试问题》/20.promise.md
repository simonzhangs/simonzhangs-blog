---
title: promise
date: 2022-03-27 11:25:36
categories: 
  - ã€ŠJavaScripté¢è¯•é—®é¢˜ã€‹
tags: 
  - promise
permalink: /pages/ed065c/
---

> [å‰ç«¯å·¥ä½œé¢è¯•é—®é¢˜](https://h5bp.org/Front-end-Developer-Interview-Questions/translations/chinese/)
>

## ä¸€ã€æ‰‹å†™promise

å‚è€ƒæ–‡ç« ï¼š

[Promiseä¸ä¼šï¼Ÿï¼Ÿçœ‹è¿™é‡Œï¼ï¼ï¼å²ä¸Šæœ€é€šä¿—æ˜“æ‡‚çš„Promiseï¼ï¼ï¼](https://juejin.cn/post/6844903607968481287#heading-0)

é˜®ä¸€å³°å¤§ç¥æ–‡ç« ï¼š[Promiseå¯¹è±¡](https://es6.ruanyifeng.com/#docs/promise)

[é¢è¯•å®˜å¯¹ä¸èµ·ï¼æˆ‘ç»ˆäºä¼šäº†Promise...(ä¸€é¢å‡‰ç»æ³ªç›®ï¼‰](https://juejin.cn/post/6952083081519955998#heading-0)

### 01.Promiseç‰¹ç‚¹

ECMAscript 6 åŸç”Ÿæä¾›äº† Promise å¯¹è±¡ã€‚

* Promise å¯¹è±¡ä»£è¡¨äº†æœªæ¥å°†è¦å‘ç”Ÿçš„äº‹ä»¶ï¼Œç”¨æ¥ä¼ é€’å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚

* promiseæœ‰ä¸‰ç§çŠ¶æ€ï¼š **pending(ç­‰å¾…æ€)ï¼Œfulfiled(æˆåŠŸæ€)ï¼Œrejected(å¤±è´¥æ€)** ï¼›

* çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ã€‚åˆ›é€ promiseå®ä¾‹åï¼Œå®ƒä¼šç«‹å³æ‰§è¡Œã€‚
* è¿™ä¸ªpromiseå¯ä»¥è§£å†³å¼‚æ­¥çš„é—®é¢˜ï¼Œæœ¬èº«ä¸èƒ½è¯´promiseæ˜¯å¼‚æ­¥çš„

ä¼˜ç‚¹ï¼š

* å°†å¼‚æ­¥æ“ä½œä»¥åŒæ­¥æ“ä½œçš„æµç¨‹è¡¨è¾¾å‡ºæ¥ï¼Œé¿å…äº†å±‚å±‚åµŒå¥—çš„å›è°ƒå‡½æ•°ï¼Œè½å…¥å›è°ƒåœ°ç‹±ï¼›
* Promise å¯¹è±¡æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œä½¿å¾—æ§åˆ¶å¼‚æ­¥æ“ä½œæ›´åŠ å®¹æ˜“

ç¼ºç‚¹ï¼š

* æ— æ³•å–æ¶ˆ Promiseï¼Œä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆï¼›
* å¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼ŒPromise å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨ï¼›
* å½“å¤„äº Pending çŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰ã€‚

### 02.ES6 promise ç”¨æ³•è¯¦è§£

Promiseæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæœ¬èº«æœ‰allã€rejectã€resolve å¸¸ç”¨æ–¹æ³•ï¼ŒåŸå‹ä¸Šæœ‰ thenã€catch ç­‰æ–¹æ³•ã€‚

Promiseæ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼šå‡½æ•°ï¼Œè¯¥å‡½æ•°éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š

* resolveï¼š å¼‚æ­¥æ“ä½œæ‰§è¡ŒæˆåŠŸåçš„å›è°ƒå‡½æ•°ï¼›
* rejectï¼š å¼‚æ­¥æ“ä½œæ‰§è¡Œå¤±è´¥åçš„å›è°ƒå‡½æ•°ã€‚

```html
const p = new Promise((resolve,reject)=>{
    setTimeout(()=>{
        console.log('æ‰§è¡Œå®Œæˆï¼');
        resolve('å¼‚æ­¥æ“ä½œæˆåŠŸå•¦ï¼')
    },2000);
})
```

#### thené“¾å¼æ“ä½œ

```html
p.then((data) => {
    console.log(data);
})
.then((data) => {
    console.log(data);
})
.then((data) => {
    console.log(data);
});
```

#### rejectç”¨æ³•

```html
const p = new Promise((resolve,reject)=>{
    setTimeout(function(){
        const num = Math.ceil(Math.random()*10);
        if(num<=5){
            resolve(num);
        }else{
            reject('æ•°å­—å¤§äº5')
        }
    },2000);
});

p.then((data)=>{
    console.log('resolved',data);
},(err)=>{
    console.log('rejected',err);
});
```

æŠŠPromiseçš„çŠ¶æ€ç½®ä¸ºrejectedï¼Œè¿™æ ·æˆ‘ä»¬åœ¨thenä¸­å°±èƒ½æ•æ‰åˆ°ï¼Œç„¶åæ‰§è¡Œâ€œå¤±è´¥â€æƒ…å†µçš„å›è°ƒã€‚

thenæ–¹æ³•å¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š

* ç¬¬ä¸€ä¸ªå¯¹åº”resolveçš„å›è°ƒï¼›
* ç¬¬äºŒä¸ªå¯¹åº”rejectçš„å›è°ƒï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿåˆ†åˆ«æ‹¿åˆ°ä»–ä»¬ä¼ è¿‡æ¥çš„æ•°æ®ã€‚

#### catchæ–¹æ³•

catchå…¶å®å®ƒå’Œthençš„ç¬¬äºŒä¸ªå‚æ•°ä¸€æ ·ï¼Œç”¨æ¥æŒ‡å®šrejectçš„å›è°ƒã€‚

```html
p.then((data)=>{
    console.log('resolved',data)
}).catch((erro)=>{
    console.log('rejected',erro);
})
```

æ­¤å¤–ï¼Œåœ¨æ‰§è¡Œresolveçš„å›è°ƒï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢thenä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰æ—¶ï¼Œå¦‚æœæŠ›å‡ºå¼‚å¸¸äº†ï¼ˆä»£ç å‡ºé”™äº†ï¼‰ï¼Œé‚£ä¹ˆå¹¶ä¸ä¼šæŠ¥é”™å¡æ­»jsï¼Œè€Œæ˜¯ä¼šè¿›åˆ°è¿™ä¸ªcatchæ–¹æ³•ä¸­ã€‚

Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰"å†’æ³¡"æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ª catch è¯­å¥æ•è·ã€‚

#### allæ–¹æ³•

è°è·‘çš„æ…¢ï¼Œä»¥è°ä¸ºå‡†æ‰§è¡Œå›è°ƒã€‚allæ¥æ”¶ä¸€ä¸ªæ•°ç»„å‚æ•°ï¼Œé‡Œé¢çš„å€¼æœ€ç»ˆéƒ½ç®—è¿”å›Promiseå¯¹è±¡ã€‚

Promiseçš„allæ–¹æ³•æä¾›äº†å¹¶è¡Œæ‰§è¡Œå¼‚æ­¥æ“ä½œçš„èƒ½åŠ›ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰æ‰§è¡Œå›è°ƒã€‚

```html
const Promise1 = new Promise(function(resolve,reject){})
const Promise2 = new Promise(function(resolve,reject){})
const Promise3 = new Promise(function(resolve,reject){})

const p = Promise.all([Promise1,Promise2,Promise3])

p.then(function(){
    //ä¸‰ä¸ªéƒ½æˆåŠŸåˆ™æˆåŠŸ
},function(){
    //åªè¦æœ‰å¤±è´¥ï¼Œåˆ™å¤±è´¥
})
```

*æœ‰ä¸€ä¸ªåœºæ™¯æ˜¯å¾ˆé€‚åˆç”¨è¿™ä¸ªçš„ï¼Œä¸€äº›æ¸¸æˆç±»çš„ç´ ææ¯”è¾ƒå¤šçš„åº”ç”¨ï¼Œæ‰“å¼€ç½‘é¡µæ—¶ï¼Œé¢„å…ˆåŠ è½½éœ€è¦ç”¨åˆ°çš„å„ç§èµ„æºå¦‚å›¾ç‰‡ã€flashä»¥åŠå„ç§é™æ€æ–‡ä»¶ã€‚æ‰€æœ‰çš„éƒ½åŠ è½½å®Œåï¼Œæˆ‘ä»¬å†è¿›è¡Œé¡µé¢çš„åˆå§‹åŒ–ã€‚*

#### raceæ–¹æ³•

è°è·‘çš„å¿«ï¼Œä»¥è°ä¸ºå‡†æ‰§è¡Œå›è°ƒã€‚

```html

function requestImg(){
    const p =new Promise((resolve,reject)=>{
        const img = new Image();
        img.onload = function(){
            resolve(img);
        }
        img.src = 'path'
    });
    return p;
}

function timeout(){
    const p = new Promise((resolve,reject)=>{
        setTimeout(() => {
            reject('å›¾ç‰‡è¯·æ±‚è¶…æ—¶');
        }, 2000);
    });
    return p;
}

Promise.race([requestImg(),timeout()])
.then((data)=>{
    console.log(data);
})
.catch((err)=>{
    console.log(err);
})
```


### 03.æ‰‹å†™Promise

å°è£…ä¸€ç³»åˆ—å†…ç½®æ–¹æ³•ï¼Œéœ€è¦åŒ…æ‹¬ï¼š

* æ•è·é”™è¯¯çš„æ–¹æ³• catch()
* è§£æå…¨éƒ¨æ–¹æ³• all()
* ç«èµ› race()
* ç”Ÿæˆä¸€ä¸ªæˆåŠŸçš„ promise resolve()
* ç”Ÿæˆä¸€ä¸ªå¤±è´¥çš„ promise reject()

## äºŒã€é—­åŒ…


## ä¸‰ã€åŸå‹


## å››ã€call apply


## äº”ã€Webpack

å‚è€ƒæ–‡ç« ï¼š

[ğŸ”¥ã€ä¸‡å­—ã€‘é€è¿‡åˆ†æ webpack é¢è¯•é¢˜ï¼Œæ„å»º webpack5.x çŸ¥è¯†ä½“ç³»](https://juejin.cn/post/7023242274876162084#heading-59)â€‹